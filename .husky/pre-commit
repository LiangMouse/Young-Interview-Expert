#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# è®°å½•è¿è¡Œå‰çš„æš‚å­˜æ–‡ä»¶
STAGED_FILES_BEFORE=$(git diff --cached --name-only)

# è¿è¡Œ lint-staged (æ ¼å¼åŒ–å’Œ lint)
echo "ğŸ“ Running lint and format..."
npx lint-staged

if [ $? -ne 0 ]; then
  echo "âŒ Lint/format failed!"
  exit 1
fi

# æ£€æŸ¥è¿è¡Œåæš‚å­˜çš„æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–
STAGED_FILES_AFTER=$(git diff --cached --name-only)

if [ "$STAGED_FILES_BEFORE" != "$STAGED_FILES_AFTER" ]; then
  echo "ğŸ”„ Files were modified during linting, staging changes..."
  echo "âœ… All changes staged. Please commit again."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
